\chapter{Exploitation et préparation}

% Indications :
%  Mise en production, déploiement, formation, support et exploitation proprement dite....
% 
% Bon courage ;-)

\section{Installation des librairies et drivers}
Afin d'assurer le bon fonctionnement de l'application, cette dernière requiert que soient présents les packages suivants (dans une version égale ou supérieure à celle précisée)~:
Les éléments nécessaires à la première mise en service sont fournis dans le livrable initial.
\\

\begin{tabularx}{\linewidth}{X X}
	\toprule
	Microsoft Windows	& GNU/Linux		\\
	\midrule
	Windows 7			&				\\
	MinGW 4.8.1 (TMD)	&				\\
	Qt 5.2.1			& Qt 5.2.1		\\
	QMySQL 5.6.16		& QMySQL 5.6.16				\\
	\bottomrule
\end{tabularx}
\\
\\
Dans le cas de figure où ces derniers soient perdus ou endommagés, le paragraphe suivant précise les procédures nécessaire à leur re-production.

\subsection{Création du pilote MySQL pour Qt5}
Cette section précise comment créer le pilote MySQL pour Qt5 en utilisant MinGW.
La rédaction de cette dernière a été motivée par le fait que le pilote en question n'est malheureusement pas fournit par défaut dans le framework Qt.


\paragraph{Installation du framework Qt}
L'installation des composants par défaut convient très bien, mais il est tout à fait possible de procéder à une installation complète. Sélectionner le répertoire racine d'installation du framework (ici C:). À terme, Qt est alors installé, ici dans le répertoire C:/Qt/Qt5.2.1.
\\
Ensuite, extraire les sources Qt dans un répertoire temporaire de son choix, puis copier le dossier \textit{qt-everywhere-opensource-src-5.2.1} ainsi obtenu dans le répertoire \textit{C:/Qt/Qt5.2.1/} et le renommer \textit{sources}.
\\
En fin de manipulation, le framework Qt est installé dans le répertoire C:/Qt/Qt5.2.1/ et les sources présentes dans C:/Qt/Qt5.2.1/sources/.

\paragraph{Installation du driver QMySQL}

\subparagraph{Installation sous Linux }
Vous avez besoin des fichiers d'en-tête de MySQL ainsi que la bibliothèque partagée \textit{libmysqlclient.so}. Selon votre distribution Linux, vous devez peut-être installer un paquet qui est généralement appelé "mysql-dev". 
\\ Dites à \textbf{qmake} où trouver les fichiers d'en-tête de MySQL et les bibliothèques partagées (ici, on suppose que MySQL est installé dans /usr/local) et lancez make : \\
\begin{lstlisting}
cd $QTDIR/src/plugins/sqldrivers/mysql
qmake "INCLUDEPATH+=/usr/local/include" "LIBS+=-L/usr/local/lib -lmysqlclient_r" mysql.pro
make
\end{lstlisting}

Après l'installation de Qt, vous devez également installer le plugin dans l'emplacement standard :
\begin{lstlisting}
cd $QTDIR/src/plugins/sqldrivers/mysql
make install
\end{lstlisting}

\subparagraph{Installation sous Windows}
Vous devez obtenir les fichiers d'installation de MySQL. Exécutez \textit{Setup.exe} et sélectionnez "Installation personnalisée". Installez le module "Libs \& Inclure les fichiers". Construire le plugin comme suit (ici on suppose que MySQL est installé dans C:\textbackslash MySQL) : \\
\begin{lstlisting}
cd %QTDIR%\src\plugins\sqldrivers\mysql
qmake "INCLUDEPATH+=C:/MySQL/include" "LIBS+=C:/MYSQL/MySQL Server 5.6.16/lib/opt/libmysql.lib" mysql.pro
nmake
\end{lstlisting}

Si vous n'utilisez pas un compilateur Microsoft, remplacer \textbf{nmake} avec \textbf{make} dans la ligne ci-dessus.
\\


\paragraph{Construction \& déploiement}
Ouvrir le terminal de commande de Qt.
Ce dernier fonctionne comme n'importe quel terminal à ceci prêt qu'il définit par défaut toutes les variables d'environnement Qt nécessaires.
Il s'ouvre sur le répertoire Qt.
\\
Exécuter les commandes suivantes~:

% XXX @mj : essaie de push des fichiers qui compilent ...

\begin{lstlisting}[language=Bash, escapechar=$]
set mysql=C:\\PROGRA~2\\MySQL\\MYSQLS~1.6
cd C:\Qt\Qt5.2.1\sources\qtbase\src\plugins\sqldrivers\mysql\
qmake "INCLUDEPATH+=%mysql%\\include" "LIBS+=%mysql%\\lib\\libmysql.lib" -o Makefile mysql.pro
mingw32-make
\end{lstlisting}
Après construction réussie (et sans erreur), des fichiers seront produits dans \\ C:/Qt/Qt5.2.1/sources/qtbase/plugins/sqldrivers, que sont~:
\begin{enumerate}
	\item libqsqlmysql.a~;
	\item libqsqlmysqld.a~;
	\item qsqlmysql.dll~;
	\item qsqlmysqld.dll.
\end{enumerate}
\begin{lstlisting}[language=Bash, escapechar=$]
For .dll files, move them to C:\Qt\QT5.1.1\5.1.1\mingw48_32\plugins\sqldrivers.

For .a files, move them to C:\Qt\Qt5.1.1\5.1.1\mingw48_32\lib

Also, copy libmysql.dll from %mysql%\lib to C:\Windows
Testing

To use the driver, don't forget to add QT += sql to project file, else it don't work.

Check which drivers are available by this code:

C++
#include <QtCore/QCoreApplication> #include <QtSql> int main() { QCoreApplication a(argc, argv); aDebug() << QSqlDatabase::drivers(); return a.exec(); }
1
2
3
4
5
6
7
8
	
#include <QtCore/QCoreApplication>
#include <QtSql>
 
int main() {
    QCoreApplication a(argc, argv);
    aDebug() << QSqlDatabase::drivers();
    return a.exec();
}

\end{lstlisting}

 \section{Procédure de génération de la base de données}
 
 \subsection{Génération des tables SQL avec JMerise}
 
 \subsubsection{Présentation}
JMerise est un logiciel dédié à la modélisation des modèles conceptuels de donnée pour Merise. Il permet aussi, les relations réflexives, la généralisation et la spécialisation des entités. Il génère le MLD et le script MySQL associé.

 \subsubsection{Procédure d'installation de JMerise}
Pour installer et utiliser JMerise, dezipper simplement le fichier "\textbf{JMerise.zip}" et exécuter le jar nommé "\textit{JMerise.jar}". 

 \subsubsection{Génération de tables SQL}
Une fois la MCD réalisée, JMerise propose une méthode de vérification qui permet de s'assurer que le modèle que l'utilisateur vient de créer est correct. Pour cela, il suffit de cliquer sur le bouton \includegraphics[scale=0.35]{checkMCD}.\\
L'outil peut aussi générer la MPD associée ainsi que le code MySQL permettant la création des tables en cliquant sur le bouton \includegraphics[scale=0.35]{convertMCD}.

\begin{figure}
\begin{center}
\includegraphics[scale=0.25]{jmerise}
\end{center}
\caption{Exemple de MCD avec JMerise}
\end{figure}

